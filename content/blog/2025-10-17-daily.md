---
title: 'クライアントとサーバーの統合'
excerpt: '2025年10月17日の日報です。'
date: '2025-10-17'
tags: ['Daily Report', 'honoRPC', 'Hono', 'Deno']
readTime: '5 min read'
published: false
---

# 前置き

2 week 弱くらい空いてしまった... 最近仕事で Rails アプデをやっていて、それが楽しくてあまり趣味プログラミングをする暇がなかったという言い訳をさせてください。

というわけで....ちょこちょこと触っていたのですが、そんなに進捗ないです。

# honoRPC

tRPC を使うという話をしていましたが、気が変わって honoRPC を利用することにしました。tRPC と打って変わって REST ぽい書き味が、やはり体に合うなという印象です。

# Integration

honoRPC を interface にして ReactNative + Expo のクライアントアプリケーションと、Hono + Deno のサーバーサイドを統合しました。

書くのは超絶簡単で、

https://hono.dev/docs/guides/rpc

こいつを見れば大体わかります。また、

https://hono.dev/docs/guides/best-practices

この辺りのベストプラクティスのドキュメントも、非常に分かりやすいとおもっています。

# Architecture

実はサーバーサイドは Layered Architecture で構成していて、クライアントは ExpoRouter があるので Expo のプラクティスに基本的には沿っています。

ただ、今回のように honoRPC の interface 部分をどこに持ってくるか、サーバーサイドの API を呼ぶようなコードをどこに書くかというのが悩みどころでした。

https://expo.dev/blog/expo-app-folder-structure-best-practices

この記事を参考にしてみました。Expo の公式記事なのでそれなりにフレームワークとの兼ね合いは考慮されたモノでしょうし。主に見ればいいのは、

https://expo.dev/blog/expo-app-folder-structure-best-practices

このサマリーの部分ですかね。今回は自分も app folder の中に api folder を切って、そこに記述しています。

```typescript
import { client } from './client';

export const fetchTest = async () => {
  try {
    const res = await client.index.$get();
    if (!res.ok) {
      throw new Error(`API Error: ${res.status}`);
    }
    const data = await res.json();
    return data;
  } catch (error) {
    throw new Error(`API Test Failed: ${error}`);
  }
};
```

例えばこんな感じです。そして、共通部分となるコードは

```typescript
import { hc } from 'hono/client';
import type { AppType } from '../../../api/src/presentation/index.ts';

// TODO: URL は環境ごとに変えたいのでどうするか考える
export const client = hc<AppType>('http://localhost:8000');
```

こんな感じで `client.ts` として逃すことにしました。気に入ってないのは `AppType` を参照するのにサーバー側のパスを指定しないといけないことですかね... この辺りは `gRPC` のようなスキーマから生成する系の interface を持つ技術スタックの方が好きだなぁと思いました。

https://x.com/_ayame113_/status/1974960185576972545

同じような気持ちを吐露している方がいた。Yusuke Wada さんもいいねと言っている。
が、どうなんでしょうね？神経質になっちゃう気持ちを抑えて、あえてこうしたのだと思っていたけれど、口ぶりから見るにそんなこともないのかもしれない？

正直僕はスキーマがある方が好きなんだけれど、今の方がシンプルで Hono らしいっちゃらしいのではという気持ちにもなった。これでスキーマ作る方がパフォーマンス出るから対応した。とかだと、それはそれで Hono らしいかもしれない。
